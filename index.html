<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>å®…å»ºæ¨¡æ“¬è©¦é¨“</title>
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="å®…å»ºè©¦é¨“">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%234facfe'/%3E%3Ctext x='50' y='60' text-anchor='middle' font-size='40' fill='white'%3EğŸ %3C/text%3E%3C/svg%3E">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
            color: #333;
        }

        .container {
            max-width: 375px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
            min-height: calc(100vh - 20px);
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 1.5em;
            margin-bottom: 10px;
        }

        .timer {
            background: rgba(255,255,255,0.2);
            padding: 10px;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            margin-top: 10px;
        }

        .progress-container {
            padding: 0 20px 10px;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .progress {
            background: rgba(255,255,255,0.3);
            height: 6px;
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-bar {
            background: white;
            height: 100%;
            transition: width 0.3s ease;
            border-radius: 3px;
        }

        .question-container {
            padding: 20px;
            min-height: 400px;
        }

        .question-number {
            background: #f0f8ff;
            color: #4facfe;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            display: inline-block;
        }

        .question-text {
            font-size: 1.1em;
            line-height: 1.6;
            margin-bottom: 20px;
            color: #2c3e50;
        }

        .choices {
            list-style: none;
        }

        .choice {
            margin-bottom: 15px;
            background: #f8f9fa;
            border-radius: 12px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .choice.selected {
            border-color: #4facfe;
            background: #e3f2fd;
        }

        .choice label {
            display: block;
            padding: 15px;
            cursor: pointer;
            font-size: 1.05em;
            line-height: 1.5;
        }

        .choice input[type="radio"] {
            display: none;
        }

        .choice:active {
            transform: scale(0.98);
        }

        .controls {
            padding: 20px;
            border-top: 1px solid #e9ecef;
            background: #f8f9fa;
        }

        .btn {
            width: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .btn:active {
            transform: scale(0.95);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn.secondary {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
        }

        .result-screen {
            display: none;
            padding: 20px;
            text-align: center;
        }

        .score-display {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 20px;
        }

        .score-number {
            font-size: 3em;
            font-weight: bold;
            margin: 10px 0;
        }

        .feedback {
            font-size: 1.2em;
            margin-top: 15px;
        }

        .answer-review {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 15px;
            margin: 10px 0;
            text-align: left;
        }

        .answer-review h4 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .correct { color: #28a745; }
        .incorrect { color: #dc3545; }

        .start-screen {
            padding: 40px 20px;
            text-align: center;
        }

        .start-screen h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .start-screen p {
            color: #666;
            line-height: 1.6;
            margin-bottom: 30px;
        }

        .settings {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: left;
        }

        .setting-item {
            margin-bottom: 15px;
        }

        .setting-item label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #2c3e50;
        }

        .setting-item select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
        }

        @media (max-height: 600px) {
            .question-container {
                min-height: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ  å®…å»ºæ¨¡æ“¬è©¦é¨“</h1>
            <div class="timer" id="timer">åˆ¶é™æ™‚é–“: --:--</div>
        </div>

        <div class="progress-container">
            <div class="progress">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
        </div>

        <!-- ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ -->
        <div id="start-screen" class="start-screen">
            <h2>ğŸ“š å®…å»ºæ¨¡æ“¬è©¦é¨“</h2>
            <p>2025å¹´åº¦è©¦é¨“å¯¾å¿œ<br>æ¨©åˆ©é–¢ä¿‚ãƒ»å®…å»ºæ¥­æ³•ãƒ»éƒ½å¸‚è¨ˆç”»æ³•ã‚’ä¸­å¿ƒã¨ã—ãŸå®Ÿæˆ¦çš„ãªå•é¡Œã§å­¦ç¿’ã—ã¾ã—ã‚‡ã†</p>
            
            <div class="settings">
                <div class="setting-item">
                    <label for="question-count">å•é¡Œæ•°</label>
                    <select id="question-count">
                        <option value="5">5å•ï¼ˆç´„9åˆ†ï¼‰</option>
                        <option value="10">10å•ï¼ˆç´„18åˆ†ï¼‰</option>
                        <option value="20" selected>20å•ï¼ˆç´„35åˆ†ï¼‰</option>
                    </select>
                </div>
                
                <div class="setting-item">
                    <label for="question-type">å‡ºé¡Œåˆ†é‡</label>
                    <select id="question-type">
                        <option value="mixed" selected>å…¨åˆ†é‡ãƒŸãƒƒã‚¯ã‚¹</option>
                        <option value="minpo">æ°‘æ³•ä¸­å¿ƒ</option>
                        <option value="takken">å®…å»ºæ¥­æ³•ä¸­å¿ƒ</option>
                        <option value="toshikeikaku">éƒ½å¸‚è¨ˆç”»æ³•ä¸­å¿ƒ</option>
                    </select>
                </div>
            </div>
            
            <button class="btn" onclick="startQuiz()">ğŸ“ è©¦é¨“é–‹å§‹</button>
        </div>

        <!-- å•é¡Œç”»é¢ -->
        <div id="quiz-screen" style="display: none;">
            <div class="question-container">
                <div class="question-number" id="question-number">å•1</div>
                <div class="question-text" id="question-text">å•é¡Œæ–‡ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</div>
                <ul class="choices" id="choices"></ul>
            </div>

            <div class="controls">
                <button class="btn" id="next-btn" onclick="nextQuestion()" disabled>æ¬¡ã®å•é¡Œã¸</button>
                <button class="btn secondary" onclick="endQuiz()">è©¦é¨“çµ‚äº†</button>
            </div>
        </div>

        <!-- çµæœç”»é¢ -->
        <div id="result-screen" class="result-screen">
            <div class="score-display">
                <h2>ğŸ“Š è©¦é¨“çµæœ</h2>
                <div class="score-number" id="final-score">0/0</div>
                <div id="percentage">0%</div>
                <div class="feedback" id="feedback">é ‘å¼µã‚Šã¾ã—ã‚‡ã†ï¼</div>
            </div>

            <div id="answer-review"></div>

            <button class="btn" onclick="resetQuiz()">ğŸ”„ ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦</button>
        </div>
    </div>

    <script>
        // å•é¡Œãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆå®Ÿéš›ã®ã‚¢ãƒ—ãƒªã§ã¯ã‚‚ã£ã¨å¤šãã®å•é¡Œã‚’å«ã‚ã‚‹ï¼‰
        const questionDatabase = [
            {
                id: 1,
                category: "æ°‘æ³•ãƒ»ç‰©æ¨©å¤‰å‹•",
                question: "AãŒBã«åœŸåœ°ã‚’å£²å´ã—ã€BãŒCã«è»¢å£²ã—ãŸå ´åˆã«ã¤ã„ã¦æ­£ã—ã„ã‚‚ã®ã¯ã©ã‚Œã‹ã€‚",
                choices: [
                    "BãŒç™»è¨˜ã‚’å—ã‘ã¦ã„ãªã„å ´åˆã€Cã¯Aã«æ‰€æœ‰æ¨©ã‚’ä¸»å¼µã§ããªã„",
                    "ABé–“å¥‘ç´„ãŒç„¡åŠ¹ã§ã‚‚ã€CãŒå–„æ„ç„¡éå¤±ãªã‚‰æ‰€æœ‰æ¨©ã‚’å–å¾—ã™ã‚‹",
                    "CãŒç™»è¨˜ã‚’å—ã‘ãŸå¾Œãªã‚‰ã€ABé–“å¥‘ç´„ãŒå–ã‚Šæ¶ˆã•ã‚Œã¦ã‚‚Cã®æ¨©åˆ©ã«å½±éŸ¿ã—ãªã„",
                    "BãŒä»£é‡‘æœªæ‰•ã„ã®å ´åˆã€CãŒä»£é‡‘æ”¯æ‰•ã„ç¾©å‹™ã‚’æ‰¿ç¶™ã™ã‚‹"
                ],
                correct: 2,
                explanation: "æ°‘æ³•94æ¡2é …ã®é¡æ¨é©ç”¨ã«ã‚ˆã‚Šã€å–„æ„ã®Cã¯ä¿è­·ã•ã‚Œã¾ã™ã€‚"
            },
            {
                id: 2,
                category: "å®…å»ºæ¥­æ³•ãƒ»é‡è¦äº‹é …èª¬æ˜",
                question: "é‡è¦äº‹é …èª¬æ˜ã«é–¢ã—ã¦æ­£ã—ã„ã‚‚ã®ã¯ã©ã‚Œã‹ã€‚",
                choices: [
                    "å¥‘ç´„æˆç«‹å¾Œã§ã‚‚ç›¸æ‰‹æ–¹ã®åŒæ„ãŒã‚ã‚Œã°èª¬æ˜ã§ãã‚‹",
                    "å®…å»ºå£«ä»¥å¤–ã§ã‚‚èª¬æ˜ã™ã‚‹ã“ã¨ãŒã§ãã‚‹",
                    "å¥‘ç´„ç· çµå‰ã«èª¬æ˜ã—ã€æ›¸é¢ã‚’äº¤ä»˜ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„",
                    "å£é ­ã§ã®èª¬æ˜ã®ã¿ã§æ›¸é¢äº¤ä»˜ã¯ä¸è¦"
                ],
                correct: 2,
                explanation: "35æ¡ã«ã‚ˆã‚Šã€å¥‘ç´„ç· çµå‰ã®èª¬æ˜ã¨æ›¸é¢äº¤ä»˜ãŒç¾©å‹™ä»˜ã‘ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚"
            },
            {
                id: 3,
                category: "å®…å»ºæ¥­æ³•ãƒ»8ã¤ã®åˆ¶é™",
                question: "æå®³è³ å„Ÿã®äºˆå®šé¡ã«ã¤ã„ã¦æ­£ã—ã„ã‚‚ã®ã¯ã©ã‚Œã‹ã€‚",
                choices: [
                    "ä»£é‡‘é¡ã®30%ã¾ã§äºˆå®šã§ãã‚‹",
                    "é•ç´„é‡‘ã¨åˆç®—ã—ã¦ä»£é‡‘é¡ã®20%ä»¥ä¸‹ã§ãªã‘ã‚Œã°ãªã‚‰ãªã„",
                    "æå®³è³ å„Ÿã®äºˆå®šã®ã¿ãªã‚‰ä»£é‡‘é¡ã®50%ã¾ã§å¯èƒ½",
                    "é•ç´„é‡‘ã¨ã¯åˆ¥ã«ä»£é‡‘é¡ã®20%ã¾ã§äºˆå®šã§ãã‚‹"
                ],
                correct: 1,
                explanation: "æå®³è³ å„Ÿäºˆå®šé¡ã¨é•ç´„é‡‘ã¯åˆç®—ã—ã¦ä»£é‡‘é¡ã®20%ä»¥ä¸‹ã§ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚"
            },
            {
                id: 4,
                category: "éƒ½å¸‚è¨ˆç”»æ³•ãƒ»é–‹ç™ºè¡Œç‚º",
                question: "é–‹ç™ºè¡Œç‚ºã«ã¤ã„ã¦æ­£ã—ã„ã‚‚ã®ã¯ã©ã‚Œã‹ã€‚",
                choices: [
                    "å¸‚è¡—åŒ–åŒºåŸŸå†…ã§ã¯1000ã¡ä»¥ä¸Šã§é–‹ç™ºè¨±å¯ãŒå¿…è¦",
                    "é–‹ç™ºå·¥äº‹å®Œäº†å‰ã§ã‚‚å»ºç¯‰å·¥äº‹ã‚’é–‹å§‹ã§ãã‚‹",
                    "å·¥äº‹å®Œäº†å…¬å‘ŠãŒã•ã‚Œã‚‹ã¾ã§å»ºç¯‰ã—ã¦ã¯ãªã‚‰ãªã„",
                    "å¸‚è¡—åŒ–èª¿æ•´åŒºåŸŸã§ã¯é¢ç©ã«é–¢ä¿‚ãªãè¨±å¯ä¸è¦"
                ],
                correct: 2,
                explanation: "å·¥äº‹å®Œäº†å…¬å‘Šã«ã‚ˆã‚Šå»ºç¯‰å¯èƒ½ãªå®…åœ°ãŒå®Œæˆã—ã¦ã‹ã‚‰å»ºç¯‰å·¥äº‹ãŒå¯èƒ½ã§ã™ã€‚"
            },
            {
                id: 5,
                category: "å€Ÿåœ°å€Ÿå®¶æ³•ãƒ»å®šæœŸå€Ÿåœ°æ¨©",
                question: "äº‹æ¥­ç”¨å®šæœŸå€Ÿåœ°æ¨©ã«ã¤ã„ã¦æ­£ã—ã„ã‚‚ã®ã¯ã©ã‚Œã‹ã€‚",
                choices: [
                    "å­˜ç¶šæœŸé–“ã«åˆ¶é™ã¯ãªã„",
                    "å±…ä½ç”¨å»ºç‰©ã‚‚å»ºç¯‰ã§ãã‚‹",
                    "å±…ä½ã®ç”¨ã«ä¾›ã™ã‚‹å»ºç‰©ã‚’å»ºç¯‰ã—ã¦ã¯ãªã‚‰ãªã„",
                    "æ™®é€šã®æ›¸é¢å¥‘ç´„ã§è¶³ã‚Šã‚‹"
                ],
                correct: 2,
                explanation: "äº‹æ¥­ç”¨å®šæœŸå€Ÿåœ°æ¨©ã¯å±…ä½ç”¨å»ºç‰©ã®å»ºç¯‰ãŒç¦æ­¢ã•ã‚Œã¦ã„ã¾ã™ã€‚"
            },
            {
                id: 6,
                category: "æ°‘æ³•ãƒ»å¥‘ç´„ä¸é©åˆè²¬ä»»",
                question: "å¥‘ç´„ä¸é©åˆè²¬ä»»ã«ã¤ã„ã¦æ­£ã—ã„ã‚‚ã®ã¯ã©ã‚Œã‹ã€‚",
                choices: [
                    "è²·ä¸»ã¯ä¸é©åˆã‚’çŸ¥ã£ãŸæ™‚ã‹ã‚‰1å¹´ä»¥å†…ã«é€šçŸ¥ãŒå¿…è¦",
                    "å£²ä¸»æ‚ªæ„ã®å ´åˆã‚‚1å¹´ä»¥å†…ã«é€šçŸ¥ãŒå¿…è¦",
                    "è¿½å®Œè«‹æ±‚ãªã—ã«ç›´ã¡ã«è§£é™¤ã§ãã‚‹",
                    "æå®³è³ å„Ÿã¨è§£é™¤ã¯ä½µç”¨ã§ããªã„"
                ],
                correct: 0,
                explanation: "è²·ä¸»ã¯ä¸é©åˆã‚’çŸ¥ã£ãŸæ™‚ã‹ã‚‰1å¹´ä»¥å†…ã®é€šçŸ¥ãŒå¿…è¦ã§ã™ãŒã€å£²ä¸»æ‚ªæ„ã®å ´åˆã¯ä¾‹å¤–ã§ã™ã€‚"
            },
            {
                id: 7,
                category: "å®…å»ºæ¥­æ³•ãƒ»å…è¨±åˆ¶åº¦",
                question: "å…è¨±æ›ãˆã«ã¤ã„ã¦æ­£ã—ã„ã‚‚ã®ã¯ã©ã‚Œã‹ã€‚",
                choices: [
                    "æ–°æ—§ä¸¡æ–¹ã®å…è¨±ã‚’ä¸¦è¡Œã—ã¦ä¿æœ‰ã§ãã‚‹",
                    "äº‹æ¥­ã‚’ä¸€æ™‚åœæ­¢ã™ã‚‹å¿…è¦ãŒã‚ã‚‹",
                    "æ–°å…è¨±å–å¾—å¾Œã€æ—§å…è¨±ã¯åŠ¹åŠ›ã‚’å¤±ã†",
                    "å…è¨±ç•ªå·ã¯å¼•ãç¶™ãŒã‚Œã‚‹"
                ],
                correct: 2,
                explanation: "å…è¨±æ›ãˆã§ã¯æ–°å…è¨±å–å¾—ã¨åŒæ™‚ã«æ—§å…è¨±ã¯åŠ¹åŠ›ã‚’å¤±ã„ã¾ã™ã€‚"
            },
            {
                id: 8,
                category: "æ°‘æ³•ãƒ»æ™‚åŠ¹",
                question: "å–å¾—æ™‚åŠ¹ã«ã¤ã„ã¦æ­£ã—ã„ã‚‚ã®ã¯ã©ã‚Œã‹ã€‚",
                choices: [
                    "å–„æ„ç„¡éå¤±ãªã‚‰10å¹´ã€ãã®ä»–ã¯20å¹´ã§å–å¾—",
                    "å æœ‰é–‹å§‹æ™‚ã®å–„æ„ç„¡éå¤±ã§åˆ¤æ–­ã•ã‚Œã‚‹",
                    "ç›—å“ã¯å–„æ„ã§ã‚‚æ™‚åŠ¹å–å¾—ã§ããªã„",
                    "æ‰€æœ‰ã®æ„æ€ã¯ä¸è¦"
                ],
                correct: 1,
                explanation: "å–å¾—æ™‚åŠ¹ã¯å æœ‰é–‹å§‹æ™‚ã®å–„æ„ç„¡éå¤±ã§æœŸé–“ãŒæ±ºã¾ã‚Šã¾ã™ã€‚"
            },
            {
                id: 9,
                category: "å®…å»ºæ¥­æ³•ãƒ»ä»²ä»‹æ‰‹æ•°æ–™",
                question: "è³ƒè²¸ä»²ä»‹ã®å ±é…¬ã«ã¤ã„ã¦æ­£ã—ã„ã‚‚ã®ã¯ã©ã‚Œã‹ã€‚",
                choices: [
                    "è²¸ä¸»å€Ÿä¸»ãã‚Œãã‚Œã‹ã‚‰1ãƒ¶æœˆåˆ†å—é ˜ã§ãã‚‹",
                    "åŒæ–¹ã‹ã‚‰å—é ˜ã™ã‚‹å ´åˆã¯åˆè¨ˆã§è³ƒæ–™1.1ãƒ¶æœˆåˆ†ä»¥å†…",
                    "å€Ÿä¸»æ‰¿è«¾ãŒã‚ã‚Œã°å€Ÿä¸»ã‹ã‚‰1.1ãƒ¶æœˆåˆ†å—é ˜ã§ãã‚‹",
                    "å ±é…¬ã«ä¸Šé™ã¯ãªã„"
                ],
                correct: 1,
                explanation: "è³ƒè²¸ä»²ä»‹ã§ã¯åŒæ–¹åˆè¨ˆã§è³ƒæ–™1.1ãƒ¶æœˆåˆ†ï¼ˆç¨è¾¼ï¼‰ãŒä¸Šé™ã§ã™ã€‚"
            },
            {
                id: 10,
                category: "æ°‘æ³•ãƒ»ä»£ç†",
                question: "ä»£ç†ã«ã¤ã„ã¦æ­£ã—ã„ã‚‚ã®ã¯ã©ã‚Œã‹ã€‚",
                choices: [
                    "æœ¬äººãŒè¡Œç‚ºèƒ½åŠ›è€…ãªã‚‰ä»£ç†äººã¯æœªæˆå¹´è€…ã§ã‚‚ã‚ˆã„",
                    "å¾©ä»£ç†äººé¸ä»»ã«ã¯æœ¬äººã®è¨±å¯ãŒå¿…è¦",
                    "è¡¨è¦‹ä»£ç†ã§ã¯æœ¬äººã¯åŠ¹æœã‚’å¦èªã§ãã‚‹",
                    "ç„¡æ¨©ä»£ç†äººã®ç›¸ç¶šã§å¿…ãšæœ‰åŠ¹ã«ãªã‚‹"
                ],
                correct: 0,
                explanation: "ä»£ç†äººã®è¡Œç‚ºèƒ½åŠ›ã¯å•é¡Œã¨ãªã‚Šã¾ã›ã‚“ã€‚æœ¬äººãŒè¡Œç‚ºèƒ½åŠ›è€…ã§ã‚ã‚Œã°ä»£ç†äººã¯æœªæˆå¹´è€…ã§ã‚‚æ§‹ã„ã¾ã›ã‚“ã€‚"
            },
            // ã•ã‚‰ã«å•é¡Œã‚’è¿½åŠ ...
            {
                id: 11,
                category: "éƒ½å¸‚è¨ˆç”»æ³•ãƒ»ç”¨é€”åœ°åŸŸ",
                question: "ç¬¬ä¸€ç¨®ä½å±¤ä½å±…å°‚ç”¨åœ°åŸŸã«ã¤ã„ã¦æ­£ã—ã„ã‚‚ã®ã¯ã©ã‚Œã‹ã€‚",
                choices: [
                    "ã‚³ãƒ³ãƒ“ãƒ‹ã‚¨ãƒ³ã‚¹ã‚¹ãƒˆã‚¢ã‚’å»ºç¯‰ã§ãã‚‹",
                    "å°è¦æ¨¡ãªäº‹å‹™æ‰€ã¯å»ºç¯‰ã§ãã‚‹",
                    "ä½å®…ã€å°å­¦æ ¡ã€è¨ºç™‚æ‰€ãªã©ãŒå»ºç¯‰ã§ãã‚‹",
                    "ãƒ•ã‚¡ãƒŸãƒªãƒ¼ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã‚’å»ºç¯‰ã§ãã‚‹"
                ],
                correct: 2,
                explanation: "ç¬¬ä¸€ç¨®ä½å±¤ä½å±…å°‚ç”¨åœ°åŸŸã§ã¯ä½å®…ã€å°å­¦æ ¡ã€è¨ºç™‚æ‰€ãªã©ã®å»ºç¯‰ãŒå¯èƒ½ã§ã™ã€‚"
            },
            {
                id: 12,
                category: "å®…å»ºæ¥­æ³•ãƒ»37æ¡æ›¸é¢",
                question: "37æ¡æ›¸é¢ã«ã¤ã„ã¦æ­£ã—ã„ã‚‚ã®ã¯ã©ã‚Œã‹ã€‚",
                choices: [
                    "å¥‘ç´„æˆç«‹å‰ã«äº¤ä»˜ã™ã‚‹",
                    "å®…å»ºå£«ã®è¨˜åæŠ¼å°ã¯ä¸è¦",
                    "å¥‘ç´„æˆç«‹å¾Œé…æ»ãªãäº¤ä»˜ã™ã‚‹",
                    "å£é ­ã§ã®èª¬æ˜ã§ä»£æ›¿ã§ãã‚‹"
                ],
                correct: 2,
                explanation: "37æ¡æ›¸é¢ã¯å¥‘ç´„æˆç«‹å¾Œé…æ»ãªãäº¤ä»˜ã—ã€å®…å»ºå£«ã®è¨˜åæŠ¼å°ãŒå¿…è¦ã§ã™ã€‚"
            }
        ];

        let currentQuiz = [];
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let startTime;
        let timerInterval;
        let selectedQuestionCount = 20;
        let timeLimit;

        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function startQuiz() {
            selectedQuestionCount = parseInt(document.getElementById('question-count').value);
            timeLimit = selectedQuestionCount * 1.8 * 60; // 1å•ã‚ãŸã‚Š1.8åˆ†
            
            // å•é¡Œã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã—ã¦é¸æŠ
            currentQuiz = shuffleArray(questionDatabase).slice(0, selectedQuestionCount);
            currentQuestionIndex = 0;
            userAnswers = [];
            
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('quiz-screen').style.display = 'block';
            document.getElementById('result-screen').style.display = 'none';
            
            startTime = Date.now();
            startTimer();
            displayQuestion();
        }

        function startTimer() {
            let timeLeft = timeLimit;
            
            timerInterval = setInterval(() => {
                timeLeft--;
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                document.getElementById('timer').textContent = 
                    `æ®‹ã‚Šæ™‚é–“: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    endQuiz();
                }
                
                // æ®‹ã‚Šæ™‚é–“ãŒå°‘ãªããªã£ãŸã‚‰è­¦å‘Šè‰²
                if (timeLeft <= 300) {
                    document.getElementById('timer').style.background = 'rgba(255, 59, 48, 0.8)';
                }
            }, 1000);
        }

        function displayQuestion() {
            const question = currentQuiz[currentQuestionIndex];
            document.getElementById('question-number').textContent = 
                `å•${currentQuestionIndex + 1}ã€${question.category}ã€‘`;
            document.getElementById('question-text').textContent = question.question;
            
            const choicesContainer = document.getElementById('choices');
            choicesContainer.innerHTML = '';
            
            question.choices.forEach((choice, index) => {
                const li = document.createElement('li');
                li.className = 'choice';
                li.innerHTML = `
                    <input type="radio" name="answer" value="${index}" id="choice${index}">
                    <label for="choice${index}">${index + 1}. ${choice}</label>
                `;
                li.addEventListener('click', () => selectAnswer(index));
                choicesContainer.appendChild(li);
            });
            
            updateProgress();
            document.getElementById('next-btn').disabled = true;
        }

        function selectAnswer(selectedIndex) {
            // å…¨ã¦ã®é¸æŠè‚¢ã‹ã‚‰selectedã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤
            document.querySelectorAll('.choice').forEach(choice => {
                choice.classList.remove('selected');
            });
            
            // é¸æŠã•ã‚ŒãŸé¸æŠè‚¢ã«selectedã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
            document.querySelectorAll('.choice')[selectedIndex].classList.add('selected');
            document.getElementById(`choice${selectedIndex}`).checked = true;
            
            // æ¬¡ã¸ãƒœã‚¿ãƒ³æœ‰åŠ¹åŒ–
            document.getElementById('next-btn').disabled = false;
            
            // æŒ¯å‹•ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼ˆiPhoneã§å¯¾å¿œã—ã¦ã„ã‚‹å ´åˆï¼‰
            if (navigator.vibrate) {
                navigator.vibrate(50);
            }
        }

        function nextQuestion() {
            const selectedAnswer = document.querySelector('input[name="answer"]:checked');
            if (selectedAnswer) {
                userAnswers[currentQuestionIndex] = parseInt(selectedAnswer.value);
            }
            
            currentQuestionIndex++;
            
            if (currentQuestionIndex < currentQuiz.length) {
                displayQuestion();
            } else {
                endQuiz();
            }
        }

        function updateProgress() {
            const progress = ((currentQuestionIndex + 1) / currentQuiz.length) * 100;
            document.getElementById('progress-bar').style.width = progress + '%';
        }

        function endQuiz() {
            clearInterval(timerInterval);
            
            // æœ€å¾Œã®å•é¡Œã®å›ç­”ã‚’ä¿å­˜
            const selectedAnswer = document.querySelector('input[name="answer"]:checked');
            if (selectedAnswer && currentQuestionIndex < currentQuiz.length) {
                userAnswers[currentQuestionIndex] = parseInt(selectedAnswer.value);
            }
            
            showResults();
        }

        function showResults() {
            document.getElementById('quiz-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'block';
            
            let correctCount = 0;
            currentQuiz.forEach((question, index) => {
                if (userAnswers[index] === question.correct) {
                    correctCount++;
                }
            });
            
            const percentage = Math.round((correctCount / currentQuiz.length) * 100);
            
            document.getElementById('final-score').textContent = `${correctCount}/${currentQuiz.length}`;
            document.getElementById('percentage').textContent = `${percentage}%`;
            
            let feedback = '';
            if (percentage >= 80) {
                feedback = 'ğŸ‰ ç´ æ™´ã‚‰ã—ã„ï¼åˆæ ¼åœå†…ã§ã™ï¼';
            } else if (percentage >= 70) {
                feedback = 'ğŸ“š åˆæ ¼ã¾ã§ã‚ã¨ä¸€æ­©ï¼';
            } else if (percentage >= 60) {
                feedback = 'ğŸ’ª åŸºç¤å›ºã‚ã‚’é ‘å¼µã‚Šã¾ã—ã‚‡ã†ï¼';
            } else {
                feedback = 'ğŸ“– ç¶™ç¶šå­¦ç¿’ã§å¿…ãšä¸Šé”ã—ã¾ã™ï¼';
            }
            document.getElementById('feedback').textContent = feedback;
            
            // è§£ç­”ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
            const reviewContainer = document.getElementById('answer-review');
            reviewContainer.innerHTML = '';
            
            currentQuiz.forEach((question, index) => {
                const isCorrect = userAnswers[index] === question.correct;
                const userChoice = userAnswers[index] !== undefined ? userAnswers[index] + 1 : 'æœªå›ç­”';
                const correctChoice = question.correct + 1;
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = 'answer-review';
                reviewDiv.innerHTML = `
                    <h4>å•${index + 1} ${isCorrect ? '<span class="correct">âœ…</span>' : '<span class="incorrect">âŒ</span>'}</h4>
                    <p><strong>ã‚ãªãŸã®å›ç­”:</strong> ${userChoice}ç•ª</p>
                    <p><strong>æ­£è§£:</strong> ${correctChoice}ç•ª</p>
                    <p><strong>è§£èª¬:</strong> ${question.explanation}</p>
                `;
                reviewContainer.appendChild(reviewDiv);
            });
        }

        function resetQuiz() {
            document.getElementById('result-screen').style.display = 'none';
            document.getElementById('start-screen').style.display = 'block';
            document.getElementById('timer').style.background = 'rgba(255,255,255,0.2)';
            document.getElementById('progress-bar').style.width = '0%';
        }

        // PWAå¯¾å¿œï¼ˆãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ å¯èƒ½ï¼‰
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('SW registered: ', registration);
                    })
                    .catch((registrationError) => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
    </script>
</body>
</html>
